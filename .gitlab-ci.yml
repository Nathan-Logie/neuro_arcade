stages:          # List of stages for jobs, and their order of execution
  - build
  - django
  - react
image: stgit.dcs.gla.ac.uk:5050/2660097h/sh08-docker:1

variables:
  PYTHON_VERSION: "3.11.5"
  MYSQL_DATABASE: $MYSQL_DB
  MYSQL_ROOT_PASSWORD: $MYSQL_PASS
  MYSQL_USER: $MYSQL_USER
  MYSQL_PASSWORD: $MYSQL_PASS

django-build-job:
  stage: build
  before_script:
  - python3 -m pip install -r requirements.txt
  script:
    - python3 neuro_arcade/manage.py makemigrations --check
    - python3 neuro_arcade/manage.py migrate
    - python3 neuro_arcade/manage.py check

unit-test-job: 
  before_script:
  - python3 -m venv venv
  - source venv/bin/activate
  - pip install -r requirements.txt
  stage: django
  script:
    - cd neuro_arcade
    - python3 manage.py test

unit-test-r-job:
  stage: react
  before_script:
    - cd neuro_arcade
    - cd reactapp
    - npm install --force
  script:
    - export CI=1
    - npm test
    #  Maybe try and export as artifact at some point?
    - npm test -- --coverage
